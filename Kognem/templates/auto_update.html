<!-- templates/auto_update.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Автообновление</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .data-container {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .connected { background: #d4edda; color: #155724; }
        .disconnected { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>Автообновление страницы каждую секунду</h1>
    
    <div id="status" class="status disconnected">
        Статус: Отключено
    </div>

    <div class="data-container">
        <h2>Данные в реальном времени:</h2>
        <div id="data">
            <p>Ожидание подключения...</p>
        </div>
    </div>

    <button onclick="connectWebSocket()">Подключиться</button>
    <button onclick="disconnectWebSocket()">Отключиться</button>

    <script>
        let ws = null;

        function connectWebSocket() {
            // Создаем WebSocket соединение
            ws = new WebSocket('ws://' + window.location.host + '/ws/updates/');
            
            ws.onopen = function() {
                updateStatus('connected', 'Статус: Подключено');
                console.log('WebSocket подключен');
            };
            
            ws.onmessage = function(event) {
                const data = JSON.parse(event.data);
                updateData(data);
            };
            
            ws.onclose = function() {
                updateStatus('disconnected', 'Статус: Отключено');
                console.log('WebSocket отключен');
            };
            
            ws.onerror = function(error) {
                console.error('WebSocket ошибка:', error);
                updateStatus('disconnected', 'Статус: Ошибка подключения');
            };
        }

        function disconnectWebSocket() {
            if (ws) {
                ws.close();
            }
        }

        function updateStatus(status, message) {
            const statusElement = document.getElementById('status');
            statusElement.textContent = message;
            statusElement.className = `status ${status}`;
        }

        function updateData(data) {
            const dataElement = document.getElementById('data');
            dataElement.innerHTML = `
                <p><strong>Счетчик:</strong> ${data.counter}</p>
                <p><strong>Время:</strong> ${new Date(data.timestamp).toLocaleTimeString()}</p>
                <p><strong>Случайное число:</strong> ${data.random_value}</p>
                <p><strong>Сообщение:</strong> ${data.message}</p>
            `;
        }

        // Автоподключение при загрузке страницы
        window.onload = connectWebSocket;
    </script>
</body>
</html>