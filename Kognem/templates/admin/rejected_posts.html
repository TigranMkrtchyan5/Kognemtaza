{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Rejected Posts</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
/* ------------------------------------- */
/* ОСНОВНЫЕ СТИЛИ СТРАНИЦЫ */
/* ------------------------------------- */
body {font-family: 'Roboto', sans-serif; background: #1b1b1b; color: #eee; margin:0; padding:0;}
header {background: linear-gradient(90deg, #b71c1c, #6aa84f); padding:20px; color:#fff; text-align:center; font-size:32px; font-weight:bold; box-shadow: 0 4px 6px rgba(0,0,0,0.5);}
header a {margin-left:20px; text-decoration:none; color:#fff; background:#6a1b9a; padding:10px 16px; border-radius:8px; transition:0.3s;}
header a:hover {opacity:0.85;}
main {padding:30px;}
h2 {color:#bfa54a; margin-top:40px; font-size:24px; border-bottom:2px solid #6aa84f; display:inline-block; padding-bottom:5px;}
table {width:100%; border-collapse:collapse; margin-top:20px; background:#222; border-radius:8px; overflow:hidden;}
th, td {padding:12px; text-align:left; border-bottom:1px solid #444;}
th {background-color:#6aa84f; color:#fff;}
tr:nth-child(even) {background-color:#1f1f1f;}
img {border-radius:6px; max-width:80px; max-height:80px;}

/* ------------------------------------- */
/* СТИЛИ ДЛЯ ТАБЛИЦЫ И ТЕКСТА */
/* ------------------------------------- */
.long-text {
    max-width: 300px; /* Ограничиваем максимальную ширину ячейки для переноса */
    word-wrap: break-word; 
    overflow-wrap: break-word;
    white-space: normal; 
}

/* ------------------------------------- */
/* СТИЛИ КНОПОК ДЕЙСТВИЙ */
/* ------------------------------------- */
button {padding: 8px 14px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.3s;}
button:hover {opacity: 0.85;}
.unreject {background-color: #27ae60; color: #fff;} 
.delete {background-color: #444; color: #fff;} 
</style>
</head>
<body>

<header>
    Rejected Posts
    <a href="{% url 'admin_dashboard' %}">Back to Dashboard</a>
</header>

<main>
<h2>All Rejected Posts</h2>

{% if posts %}
<table>
<thead>
<tr>
    <th>ID</th>
    <th>Title</th>
    <th>User</th>
    <th>Image</th>
    <th>Description</th>
    <th>Location</th>
    <th>Price</th>
    <th>Status</th>
    <th>Rejection Reason</th> <th>Actions</th>
</tr>
</thead>
<tbody>
{% for post in posts %}
{# В этой вьюхе мы уже отфильтровали посты со статусом 'rejected', поэтому дополнительная проверка IF не нужна #}
<tr>
    <td>{{ post.id }}</td>
    <td>{{ post.title }}</td>
    <td>{{ post.user.username }}</td>
    <td>{% if post.image %}<img src="{{ post.image.url }}" alt="{{ post.title }}">{% endif %}</td>
    <td class="long-text">{{ post.description }}</td>
    <td>{{ post.location }}</td>
    <td>{{ post.price }}</td>
    <td><span style="color:#b71c1c;">{{ post.status|capfirst }}</span></td>
        <td class="long-text"><strong>{{ post.rejection_reason|default:"(No reason specified)" }}</strong></td> 
    <td>
        <button class="unreject" onclick="approvePost('{{ post.id }}')">Approve</button>
        <button class="delete" onclick="deletePost('{{ post.id }}')">Delete</button>
    </td>
</tr>
{% endfor %}
</tbody>
</table>
{% else %}
<p style="color:#bfa54a;">No rejected posts available.</p>
{% endif %}

</main>

<script>
// ----------------- AJAX Action Functions -----------------

// Функция для одобрения поста (отмена отказа)
async function approvePost(postId) {
    if (!confirm("Are you sure you want to approve this rejected post?")) return;
    
    // Предполагается, что у вас есть URL /admin/posts/approve/<int:post_id>/
    const res = await fetch(`/admin/posts/approve/${postId}/`, {
        method: 'POST', 
        headers: {'X-CSRFToken': '{{ csrf_token }}'}
    });
    if (res.ok) location.reload();
}

// Функция для удаления поста
async function deletePost(postId) {
    if (!confirm("Are you sure you want to permanently delete this post?")) return;
    
    // Предполагается, что у вас есть URL /admin/posts/delete/<int:post_id>/
    const res = await fetch(`/admin/posts/delete/${postId}/`, {
        method: 'POST', 
        headers: {'X-CSRFToken': '{{ csrf_token }}'}
    });
    if (res.ok) location.reload();
}
</script>
</body>
</html>