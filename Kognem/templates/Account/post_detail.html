{% extends 'base.html' %}
{% load static %}

{% block title %}Kognem — {{ post.title }}{% endblock %}

{% block extra_head %}
<style>
    :root {
        --primary: #6C63FF;
        --primary-dark: #5A52D5;
        --primary-light: #8B85FF;
        --secondary: #FF6584;
        --secondary-dark: #E04F6D;
        --secondary-light: #FF8BA0;
        --accent: #36D1DC;
        --light-bg: #FFFFFF;
        --light-secondary: #F8F9FA;
        --light-border: #E9ECEF;
        --text-dark: #2D3748;
        --text-medium: #4A5568;
        --text-light: #718096;
        --shadow-light: 0 4px 6px rgba(0, 0, 0, 0.03);
        --shadow-medium: 0 10px 15px rgba(0, 0, 0, 0.07);
        --shadow-large: 0 20px 25px rgba(0, 0, 0, 0.1);
        --gradient-primary: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
    }

    .page-main {
        min-height: 80vh;
        padding: 40px 20px;
        background: var(--light-bg);
        position: relative;
        overflow: hidden;
    }

    .post-detail-container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border: 1px solid var(--light-border);
        border-radius: 24px;
        box-shadow: var(--shadow-medium);
        overflow: hidden;
        transform: translateY(30px);
        opacity: 0;
        animation: fadeInUp 1s forwards 0.2s;
    }

    /* Header Section */
    .post-header {
        padding: 40px 40px 30px;
        border-bottom: 1px solid var(--light-border);
        background: var(--light-secondary);
    }

    .post-title {
        font-size: 2.2rem;
        font-weight: 800;
        margin-bottom: 15px;
        background: var(--gradient-primary);
        -webkit-text-fill-color: transparent;
        line-height: 1.3;
    }

    .post-meta {
        display: flex;
        align-items: center;
        gap: 20px;
        flex-wrap: wrap;
    }

    .post-status {
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .status-approved {
        background: rgba(16, 185, 129, 0.1);
        color: #10b981;
        border: 1px solid rgba(16, 185, 129, 0.2);
    }

    .status-pending {
        background: rgba(245, 158, 11, 0.1);
        color: #f59e0b;
        border: 1px solid rgba(245, 158, 11, 0.2);
    }

    .status-rejected {
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
        border: 1px solid rgba(239, 68, 68, 0.2);
    }

    .post-date {
        color: var(--text-light);
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    /* Main Content Layout */
    .post-main-content {
        display: grid;
        grid-template-columns: 1fr 400px;
        gap: 0;
    }

    /* Left Column - Content */
    .post-content-column {
        padding: 40px;
        border-right: 1px solid var(--light-border);
    }

    /* Image Section */
    .post-image-section {
        margin-bottom: 30px;
    }

    .post-image {
        width: 100%;
        max-height: 400px;
        object-fit: cover;
        border-radius: 16px;
        box-shadow: var(--shadow-light);
        transition: transform 0.3s ease;
    }

    .post-image:hover {
        transform: scale(1.02);
    }

    .no-image {
        height: 300px;
        background: var(--gradient-primary);
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 4rem;
        box-shadow: var(--shadow-light);
    }

    /* Content Section */
    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .info-card {
        background: var(--light-secondary);
        padding: 20px;
        border-radius: 12px;
        border: 1px solid var(--light-border);
        transition: all 0.3s ease;
    }

    .info-card:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow-light);
        border-color: var(--primary-light);
    }

    .info-icon {
        width: 40px;
        height: 40px;
        background: var(--gradient-primary);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 12px;
        color: white;
        font-size: 1.1rem;
    }

    .info-label {
        font-size: 0.85rem;
        color: var(--text-light);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 600;
        margin-bottom: 6px;
    }

    .info-value {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--text-dark);
        line-height: 1.4;
    }

    .info-value.price {
        color: var(--primary);
        font-size: 1.3rem;
    }

    /* Description Section */
    .description-section {
        margin-bottom: 30px;
    }

    .section-title {
        font-size: 1.3rem;
        font-weight: 700;
        color: var(--text-dark);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .section-title::before {
        content: '';
        width: 6px;
        height: 6px;
        background: var(--gradient-primary);
        border-radius: 50%;
    }

    .description-content {
        background: var(--light-secondary);
        padding: 20px;
        border-radius: 12px;
        border: 1px solid var(--light-border);
        line-height: 1.7;
        color: var(--text-medium);
        font-size: 1.05rem;
    }

    /* Right Column - Map & Actions */
    .post-sidebar {
        padding: 40px;
        background: var(--light-secondary);
        display: flex;
        flex-direction: column;
        gap: 30px;
    }

    /* Map Section */
    .map-section {
        flex: 1;
    }

    .map-container {
        height: 300px;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: var(--shadow-light);
        border: 1px solid var(--light-border);
        background: var(--light-bg);
    }

    #post-map {
        width: 100%;
        height: 100%;
        border-radius: 12px;
    }

    .map-placeholder {
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: var(--gradient-primary);
        color: white;
        text-align: center;
        padding: 20px;
    }

    .map-placeholder i {
        font-size: 3rem;
        margin-bottom: 15px;
    }

    .map-placeholder p {
        font-size: 1rem;
        opacity: 0.9;
    }

    /* Location Info */
    .location-info {
        background: white;
        padding: 20px;
        border-radius: 12px;
        border: 1px solid var(--light-border);
        box-shadow: var(--shadow-light);
    }

    .location-title {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--text-dark);
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .location-details {
        color: var(--text-medium);
        line-height: 1.5;
    }

    /* Contact & Actions */
    .contact-section {
        background: white;
        padding: 25px;
        border-radius: 12px;
        border: 1px solid var(--light-border);
        box-shadow: var(--shadow-light);
    }

    .contact-title {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--text-dark);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .contact-buttons {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .contact-btn {
        padding: 12px 20px;
        border-radius: 10px;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 10px;
        border: none;
        cursor: pointer;
        font-size: 0.95rem;
        text-align: center;
        justify-content: center;
    }

    .message-btn {
        background: var(--gradient-primary);
        color: white;
        box-shadow: var(--shadow-light);
    }

    .message-btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-medium);
    }

    .call-btn {
        background: white;
        color: var(--text-dark);
        border: 1px solid var(--light-border);
    }

    .call-btn:hover {
        background: var(--primary-light);
        color: white;
        border-color: var(--primary);
    }

    /* Actions Section */
    .actions-section {
        padding: 30px 40px;
        border-top: 1px solid var(--light-border);
        background: var(--light-secondary);
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
    }

    .action-btn {
        padding: 12px 24px;
        border-radius: 12px;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        border: none;
        cursor: pointer;
        font-size: 0.95rem;
    }

    .back-btn {
        background: var(--gradient-primary);
        color: white;
        box-shadow: var(--shadow-light);
    }

    .back-btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-medium);
    }

    .edit-btn {
        background: white;
        color: var(--text-dark);
        border: 1px solid var(--light-border);
    }

    .edit-btn:hover {
        background: var(--primary-light);
        color: white;
        border-color: var(--primary);
    }

    .delete-btn {
        background: var(--secondary);
        color: white;
        box-shadow: var(--shadow-light);
    }

    .delete-btn:hover {
        background: var(--secondary-dark);
        transform: translateY(-2px);
        box-shadow: var(--shadow-medium);
    }

    /* Animations */
    @keyframes fadeInUp {
        0% { opacity: 0; transform: translateY(30px); }
        100% { opacity: 1; transform: translateY(0); }
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
        .post-main-content {
            grid-template-columns: 1fr;
        }
        
        .post-content-column {
            border-right: none;
            border-bottom: 1px solid var(--light-border);
        }
        
        .post-sidebar {
            padding: 30px;
        }
    }

    @media (max-width: 768px) {
        .post-detail-container {
            margin: 20px;
        }

        .post-header {
            padding: 30px 25px 20px;
        }

        .post-title {
            font-size: 1.8rem;
        }

        .post-content-column {
            padding: 30px 25px;
        }

        .info-grid {
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .post-sidebar {
            padding: 25px;
        }

        .actions-section {
            padding: 25px;
            flex-direction: column;
        }

        .action-btn {
            width: 100%;
            justify-content: center;
        }
    }

    @media (max-width: 480px) {
        .post-header {
            padding: 25px 20px 15px;
        }

        .post-title {
            font-size: 1.6rem;
        }

        .post-content-column {
            padding: 25px 20px;
        }

        .post-image-section {
            margin-bottom: 20px;
        }

        .info-card {
            padding: 15px;
        }

        .description-content {
            padding: 15px;
        }

        .post-sidebar {
            padding: 20px;
        }
    }
</style>

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
{% endblock %}

{% block body %}
<main class="page-main">
    <section class="post-detail-container">
        <!-- Header -->
        <div class="post-header">
            <h1 class="post-title">{{ post.title }}</h1>
            <div class="post-meta">
                <div class="post-status status-{{ post.status }}">
                    {{ post.get_status_display }}
                </div>
                <div class="post-date">
                    <i class="fas fa-calendar"></i>
                    {{ post.created_at|date:"F d, Y" }}
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="post-main-content">
            <!-- Left Column - Content -->
            <div class="post-content-column">
                <!-- Image -->
                <div class="post-image-section">
                    {% if post.image %}
                        <img src="{{ post.image.url }}" alt="{{ post.title }}" class="post-image">
                    {% else %}
                        <div class="no-image">
                            <i class="fas fa-tasks"></i>
                        </div>
                    {% endif %}
                </div>

                <!-- Info Grid -->
                <div class="info-grid">
                    <div class="info-card">
                        <div class="info-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="info-label">Տեղակայություն</div>
                        <div class="info-value">{{ post.location|default:"Չի նշված" }}</div>
                    </div>

                    <div class="info-card">
                        <div class="info-icon">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="info-label">Գին</div>
                        <div class="info-value price">
                            {% if post.price %}
                                ${{ post.price }}
                            {% else %}
                                Չի նշված
                            {% endif %}
                        </div>
                    </div>

                    <div class="info-card">
                        <div class="info-icon">
                            <i class="fas fa-tag"></i>
                        </div>
                        <div class="info-label">Կատեգորիա</div>
                        <div class="info-value">{{ post.category.name|default:"Չի նշված" }}</div>
                    </div>

                    <div class="info-card">
                        <div class="info-icon">
                            <i class="fas fa-layer-group"></i>
                        </div>
                        <div class="info-label">Շրջան</div>
                        <div class="info-value">
                            {% if post.province and post.state %}
                                {{ post.province.name }}, {{ post.state.name }}
                            {% else %}
                                Չի նշված
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Description -->
                <div class="description-section">
                    <h3 class="section-title">
                        <i class="fas fa-align-left"></i>
                        Նկարագրություն
                    </h3>
                    <div class="description-content">
                        {{ post.description|default:"Այս հայտարարությունը նկարագրություն չունի։"|linebreaks }}
                    </div>
                </div>

                <!-- Additional Information -->
                <div class="info-grid">
                    <div class="info-card">
                        <div class="info-icon">
                            <i class="fas fa-eye"></i>
                        </div>
                        <div class="info-label">Դիտումներ</div>
                        <div class="info-value">0</div>
                    </div>

                    <div class="info-card">
                        <div class="info-icon">
                            <i class="fas fa-comments"></i>
                        </div>
                        <div class="info-label">Հաղորդագրություններ</div>
                        <div class="info-value">0</div>
                    </div>
                </div>
            </div>

            <!-- Right Column - Map & Actions -->
            <div class="post-sidebar">
                <!-- Map Section -->
                <div class="map-section">
                    <h3 class="section-title">
                        <i class="fas fa-map"></i>
                        Տեղակայություն Քարտեզի Վրա
                    </h3>
                    <div class="map-container">
                        <div id="post-map"></div>
                    </div>
                </div>

                <!-- Location Details -->
                <div class="location-info">
                    <h4 class="location-title">
                        <i class="fas fa-info-circle"></i>
                        Տեղակայության Մանրամասներ
                    </h4>
                    <div class="location-details">
                        <p><strong>Հասցե:</strong> {{ post.location|default:"Չի նշված" }}</p>
                        {% if post.province and post.state %}
                            <p><strong>Շրջան:</strong> {{ post.province.name }}, {{ post.state.name }}</p>
                        {% endif %}
                        <p><strong>Կատեգորիա:</strong> {{ post.category.name|default:"Չի նշված" }}</p>
                    </div>
                </div>

                <!-- Contact Section -->
                <div class="contact-section">
                    <h4 class="contact-title">
                        <i class="fas fa-user"></i>
                        Կապ Հաստատել
                    </h4>
                    <div class="contact-buttons">
                        <a href="{% url 'create_room' post.user.username %}" class="contact-btn message-btn">
                            <i class="fas fa-comment"></i>
                            Հաղորդագրություն Ուղարկել
                        </a>
                        <button class="contact-btn call-btn" onclick="showContactInfo()">
                            <i class="fas fa-phone"></i>
                            Կոնտակտային Տվյալներ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="actions-section">
            <a href="{% url 'myposts' %}" class="action-btn back-btn">
                <i class="fas fa-arrow-left"></i>
                Վերադառնալ Իմ Հայտարարություններին
            </a>
            <a href="#" class="action-btn edit-btn">
                <i class="fas fa-edit"></i>
                Խմբագրել Հայտարարությունը
            </a>
            <a href="#" class="action-btn delete-btn">
                <i class="fas fa-trash"></i>
                Ջնջել Հայտարարությունը
            </a>
        </div>
    </section>
</main>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    // Initialize map
    function initMap() {
        // Default coordinates (Yerevan, Armenia)
        const defaultLat = 40.1792;
        const defaultLng = 44.4991;
        
        // Create map
        const map = L.map('post-map').setView([defaultLat, defaultLng], 12);
        
        // Add tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
        
        // Try to geocode the location if available
        const location = "{{ post.location }}";
        if (location && location !== "Չի նշված") {
            geocodeLocation(location, map);
        } else {
            // Show default marker with post title
            const marker = L.marker([defaultLat, defaultLng]).addTo(map);
            marker.bindPopup(`
                <div style="text-align: center;">
                    <strong>{{ post.title }}</strong><br>
                    <small>Տեղակայությունը չի նշված</small>
                </div>
            `).openPopup();
        }
    }
    
    // Geocode location using OpenStreetMap Nominatim
    function geocodeLocation(location, map) {
        const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(location)}&limit=1`;
        
        fetch(url)
            .then(response => response.json())
            .then(data => {
                if (data && data.length > 0) {
                    const lat = parseFloat(data[0].lat);
                    const lon = parseFloat(data[0].lon);
                    
                    // Update map view
                    map.setView([lat, lon], 14);
                    
                    // Add marker
                    const marker = L.marker([lat, lon]).addTo(map);
                    marker.bindPopup(`
                        <div style="text-align: center;">
                            <strong>{{ post.title }}</strong><br>
                            <small>${location}</small>
                        </div>
                    `).openPopup();
                } else {
                    // Location not found, show default
                    showDefaultMap(map);
                }
            })
            .catch(error => {
                console.error('Geocoding error:', error);
                showDefaultMap(map);
            });
    }
    
    function showDefaultMap(map) {
        const defaultLat = 40.1792;
        const defaultLng = 44.4991;
        
        map.setView([defaultLat, defaultLng], 10);
        const marker = L.marker([defaultLat, defaultLng]).addTo(map);
        marker.bindPopup(`
            <div style="text-align: center;">
                <strong>{{ post.title }}</strong><br>
                <small>Տեղակայությունը չի գտնվել</small>
            </div>
        `).openPopup();
    }
    
    // Contact info modal
    function showContactInfo() {
        alert('Կոնտակտային տվյալներ:\n\nՕգտատեր: {{ post.user.username }}\nԷլ. փոստ: {{ post.user.email }}\n\nԽնդրում ենք օգտագործել հաղորդագրությունների համակարգը կապ հաստատելու համար։');
    }
    
    // Add interactive animations
    document.addEventListener('DOMContentLoaded', () => {
        // Initialize map
        initMap();
        
        // Add hover effects to info cards
        const infoCards = document.querySelectorAll('.info-card');
        infoCards.forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-3px)';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });
        });

        // Add click animation to action buttons
        const actionButtons = document.querySelectorAll('.action-btn, .contact-btn');
        actionButtons.forEach(button => {
            button.addEventListener('click', function(e) {
                // Create ripple effect
                const ripple = document.createElement('span');
                const rect = this.getBoundingClientRect();
                const size = Math.max(rect.width, rect.height);
                const x = e.clientX - rect.left - size / 2;
                const y = e.clientY - rect.top - size / 2;
                
                ripple.style.cssText = `
                    position: absolute;
                    border-radius: 50%;
                    background: rgba(255, 255, 255, 0.6);
                    transform: scale(0);
                    animation: ripple 0.6s linear;
                    width: ${size}px;
                    height: ${size}px;
                    left: ${x}px;
                    top: ${y}px;
                    pointer-events: none;
                `;
                
                this.appendChild(ripple);
                
                setTimeout(() => {
                    ripple.remove();
                }, 600);
            });
        });

        // Add CSS for ripple animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes ripple {
                to {
                    transform: scale(4);
                    opacity: 0;
                }
            }
            .action-btn, .contact-btn {
                position: relative;
                overflow: hidden;
            }
        `;
        document.head.appendChild(style);
    });
</script>
{% endblock %}